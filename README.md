# Geometric Distortions in GNS

## There is not yet a define pipeline. Here the name and description of some scripts

##  Prepare the data

- In this pipeline we are using the reduce fits images from GNS2 pipeline. This images are flat, sky, etc reduce.
- This images are dividen by chips and have no astrometic solotion
- Run `cubes_for_gd_corrections.fits` to give these files an astrometic solutions (using astroaling)



- Runs `missfits`on cubes to divide them into slices. Then make a .list file containing the paths and names of the slices and feed with it `maxitrack`
- **% missfits -d > default.missfits** generates de default configurataion file. 
- On the configuration file you can set `OUTFILE_TYPE  SPLIT` and `SAVE_TYPE NEW`. This would slice the MEF and conserve the original file, while saving the slices under a new name.
- Make a .list files with then names and tha absolutes paths of the new genareted *miss* slices: ** ls *.miss.fits | xargs realpath > part[1,1]_c[1,2,3,4]_fits.list **

### maxitract_chips.sh 
- Runs maxitract on fits slices for diffentes chips and rename the output file maxitract.output. This scriptys can be in the GNS1 folder

### maxitraxt_bad_slices.py

- Combines all the maxitrack output files in a single list. This is combinient for comparing the bad slices selected by maxitrack with the bad slices selected by the operator (me)

## Astromatic

### Photometry
- `./sextractor.sh`
- We have to run `sextrator` to a first estimate of the psf
- Then we have to run `PSFex` to extract a field variable psf
- Finally we run `sextracto` agaim, feeded with the vairable psf

### SCAMP
- `./scamp.sh`
- We use `scamp` to calculate the variability of the *pixel scale* acrros the chip, the geomtric distortion
- It has to be use in the individuals fits files.



















# WARNING
---
This is the old readme, not useful anymore!!!. 

---
## Steps to Estimate and Apply Geometric Distortions (GD) on GNS2

---

### 0. Prepare Cubes for GD Corrections
- Run `cubes_for_gd_corrections.py` to group all the cleaned cubes (reduced for sky, flat-fielded, and cleaned for cosmic rays) into four FITS files, one for each chip.
- This script automatically runs `missfits`, which groups all the slices into a cube and deletes the individual slices afterward.
- The generated cubes will have the correct format for use with Astromatic software. **Inspect the generated cubes carefully**.

#### 0.1 Optional: Remove Bad Frames
- Use `delete_bad.py` if additional bad slices are detected during inspection. In principle, the cubes used in `cubes_for_gd_corrections.py` should already be cleaned of bad frames.
- The script moves the bad slices to a `bad_slices` folder for each field. (**Send these folders to Hervé**.)

#### 0.2 Optional: Check Bad Frames:
- `cubes_for_checking.py`it combined slices in a cube for ocular inspection. It uses `missfits` software.
- `rename_fits.sh` rename some files that Hervé send me to adecuate them to the format required by `missfits`
---

### Astromatic.py
- This script runs all three steps required for GD corrections (#1, #2, and #3), namely: `sextractor`, `scamp`, and `swarp`.

---

### Alternative: Running Steps Separately
If desired, you can run `sextractor`, `scamp`, and `swarp` separately as described below:

#### 1. Run Source Extractor
- Execute `source-extractor cube.fits -c default_c[1,2,3,4].sex`. This will generate a **MEF (Multi-Extension FITS)** file with different pointings, with an extension for each image.
- Ensure that this cube was created using the `cubes_for_gd_corrections.py` script.
- Edit the `default.param` file to select the variables required by SCAMP. A list of all available SExtractor variables can be found in `default.sex`.

#### 2. Run SCAMP
- Run the command: `scamp sextractor.cat -c scamp.conf`.
- SExtractor will generate a catalog to feed into SCAMP, which calculates the geometric distortion. SCAMP will generate a `header.head` file.

#### 3. Run SWarp
- Run `SWarp cube.fits`. 
- The `.head` file generated by SCAMP is used to modify the original `cube.fits`. Ensure this `.head` file is correctly referenced in the configuration.

---

### 4. Apply Axis Correction
- Run `axis_correction.py` to equalize the axes in the FITS files generated by SWarp. This step updates the WCS information accordingly.

---

Follow these steps to properly apply geometric distortion corrections to GNS2 data.

